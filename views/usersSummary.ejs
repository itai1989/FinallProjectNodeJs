<%- include('top') %>

<div class="container">
  <h1> 住 转  砖转砖</h1>

  <form id="summaryForm" onsubmit="fetchUsersSummary(event)">
    <label>砖: <input type="number" id="month" min="1" max="12" required></label>
    <label>砖: <input type="number" id="year" min="2000" max="2100" required></label>
    <button type="submit"> 爪 转</button>
  </form>

  <h3>转 砖转砖</h3>
  <table border="1">
    <thead>
      <tr>
        <th>砖</th>
        <th>爪注 注专 </th>
        <th>爪注 注专 </th>
        <th>爪注 驻拽</th>
        <th>转 专转 - </th>
        <th>转 专转 - </th>
        <th>转 专转 - 驻拽</th>
      </tr>
    </thead>
    <tbody id="usersTable">
      <tr><td colspan="7"> 专 砖 砖 爪 转爪转</td></tr>
    </tbody>
  </table>
</div>

<script>
  async function fetchUsersSummary(event) {
    event.preventDefault();

    const month = document.getElementById('month').value;
    const year = document.getElementById('year').value;
    const tableBody = document.getElementById('usersTable');

    if (!month || !year) return alert("砖 专 砖 砖!");

    try {
      const res = await fetch("/measurements/summary", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ month, year })
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.message);

      tableBody.innerHTML = "";
      if (data.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='7'> 爪 转 砖 砖 砖专</td></tr>";
        return;
      }

      data.forEach(user => {
        const row = document.createElement("tr");

        //  砖注专  住驻专
        const avgLow = parseFloat(user.avgLow) || 0;
        const avgHigh = parseFloat(user.avgHigh) || 0;
        const avgPulse = parseFloat(user.avgPulse) || 0;

        row.innerHTML = `
          <td>${user.name}</td>
          <td>${avgLow.toFixed(2)}</td>
          <td>${avgHigh.toFixed(2)}</td>
          <td>${avgPulse.toFixed(2)}</td>
          <td style="color: ${user.highOutliers > 0 ? 'red' : 'black'}">${user.highOutliers}</td>
          <td style="color: ${user.lowOutliers > 0 ? 'blue' : 'black'}">${user.lowOutliers}</td>
          <td style="color: ${user.pulseLowOutliers > 0 ? 'blue' : user.pulseHighOutliers > 0 ? 'red' : 'black'}">${user.pulseLowOutliers + user.pulseHighOutliers}</td>`;
        tableBody.appendChild(row);
      });
    } catch (error) {
      tableBody.innerHTML = <tr><td colspan="7">${error.message}</td></tr>;
    }
  }
</script>

<%- include('bottom') %>