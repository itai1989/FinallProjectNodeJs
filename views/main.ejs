<%- include('top') %>
<div class="container">
  <h1>住驻转 注专 拽转</h1>
  <h2>专 驻</h2>
  
  <select name="user" id="selectUser">
    <option value="">专 砖转砖</option>
    <% users.forEach(user => { %>
      <option value="<%= user.id %>"><%= user.name %></option>
    <% }) %>
  </select>
  <button onclick="goToHistory()"> 爪驻 住专转 转</button>
  <h3>住驻转  砖</h3>
  <form id="measurementForm" onsubmit="submitMeasurement(event)">
    <label>转专: <input type="date" id="date" required></label>
    <label>注专 : <input type="number" id="lowValue" required></label>
    <label>注专 : <input type="number" id="highValue" required></label>
    <label>驻拽: <input type="number" id="pulse" required></label>
    <button type="submit">砖 </button>
  </form>
</div>

<script>
  function goToHistory() {
    const userId = document.getElementById('selectUser').value;
    if (!userId) return alert("专 驻 拽!");
    
    window.location.href = `/pages/history/${userId}`;
  }

  async function submitMeasurement(event) {
    event.preventDefault();

    const userId = document.getElementById('selectUser').value;
    if (!userId) return alert("专 驻 拽!");

    const date = document.getElementById('date').value;
    const lowValue = document.getElementById('lowValue').value;
    const highValue = document.getElementById('highValue').value;
    const pulse = document.getElementById('pulse').value;

    try {
      const res = await fetch('/measurements', {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId, date, lowValue, highValue, pulse })
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.message);

      alert(" 住驻 爪!");
    } catch (error) {
      alert(error.message);
    }
  }
</script>

<%- include('bottom') %>